# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –ü–µ—Ä–µ—Å—á—ë—Ç –ö–ë–ñ–£ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Å–∞ –µ–¥—ã

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Å–∞ –µ–¥—ã –≤ —Ñ—É–Ω–∫—Ü–∏–∏ "–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏—ë–º –ø–∏—â–∏" –∫–∞–ª–æ—Ä–∏–∏ –∏ –ë–ñ–£ (–±–µ–ª–∫–∏, –∂–∏—Ä—ã, —É–≥–ª–µ–≤–æ–¥—ã) –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–ª–∏—Å—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω–æ–≤–æ–º—É –≤–µ—Å—É.

## –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ—Å—á—ë—Ç–∫–∞ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Å–∞ –µ–¥—ã.

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª—ë–Ω –º–µ—Ç–æ–¥ `update_food_log` –≤ `health_service.py`
- **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Å—á—ë—Ç–∞**: –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `estimated_weight_g` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- **–ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç**: –ù–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è = —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è √ó (–Ω–æ–≤—ã–π –≤–µ—Å / —Å—Ç–∞—Ä—ã–π –≤–µ—Å)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–µ—Ä–µ—Å—á—ë—Ç–∞

```python
# Check if weight is being updated and we need to recalculate nutrition
if 'estimated_weight_g' in updates and food_log.estimated_weight_g:
    old_weight = food_log.estimated_weight_g
    new_weight = updates['estimated_weight_g']
    
    # Calculate ratio for proportional recalculation
    if old_weight > 0:
        ratio = new_weight / old_weight
        
        # Recalculate nutrition values proportionally
        updates['calories'] = round(food_log.calories * ratio, 1)
        updates['protein_g'] = round(food_log.protein_g * ratio, 1)
        updates['fat_g'] = round(food_log.fat_g * ratio, 1)
        updates['carbs_g'] = round(food_log.carbs_g * ratio, 1)
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `recalculate_food_nutrition`
- **–û—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥**: –î–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Å—á—ë—Ç –±–µ–∑ –¥—Ä—É–≥–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ –∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –≤–µ—Å–∞

### 3. –û–±–Ω–æ–≤–ª—ë–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `_handle_food_edit_input` –≤ `telegram_service.py`
- **–£–ª—É—á—à–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**: –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Å–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∏ –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à—ë–ª –ø–µ—Ä–µ—Å—á—ë—Ç

```python
if field == 'estimated_weight_g':
    message = f"""‚úÖ *–í–µ—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!*

üìä *–ù–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:*
‚Ä¢ –í–µ—Å: {new_value}–≥ (–±—ã–ª–æ {current_food_log.estimated_weight_g}–≥)
‚Ä¢ –ö–∞–ª–æ—Ä–∏–∏: {updated_food_log.calories} –∫–∫–∞–ª (–±—ã–ª–æ {current_food_log.calories} –∫–∫–∞–ª)
‚Ä¢ –ë–µ–ª–∫–∏: {updated_food_log.protein_g}–≥ (–±—ã–ª–æ {current_food_log.protein_g}–≥)
‚Ä¢ –ñ–∏—Ä—ã: {updated_food_log.fat_g}–≥ (–±—ã–ª–æ {current_food_log.fat_g}–≥)
‚Ä¢ –£–≥–ª–µ–≤–æ–¥—ã: {updated_food_log.carbs_g}–≥ (–±—ã–ª–æ {current_food_log.carbs_g}–≥)

üîÑ *–ó–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω–æ–≤–æ–º—É –≤–µ—Å—É*"""
```

## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- –í–µ—Å: 250–≥
- –ö–∞–ª–æ—Ä–∏–∏: 400 –∫–∫–∞–ª
- –ë–µ–ª–∫–∏: 15–≥
- –ñ–∏—Ä—ã: 20–≥
- –£–≥–ª–µ–≤–æ–¥—ã: 30–≥

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ—Å–∞ –Ω–∞ 350–≥:
- –í–µ—Å: 350–≥ (+40%)
- –ö–∞–ª–æ—Ä–∏–∏: 560 –∫–∫–∞–ª (+40%)
- –ë–µ–ª–∫–∏: 21–≥ (+40%)
- –ñ–∏—Ä—ã: 28–≥ (+40%)
- –£–≥–ª–µ–≤–æ–¥—ã: 42–≥ (+40%)

## –†–µ–∑—É–ª—å—Ç–∞—Ç
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á—ë—Ç**: –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Å–∞ –µ–¥—ã –≤—Å–µ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
‚úÖ **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
‚úÖ **–¢–æ—á–Ω–æ—Å—Ç—å**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–π –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏
‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–µ—Ä–µ—Å—á—ë—Ç–∞ –≤ –ª–æ–≥–∞—Ö

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Å–∞ –µ–¥—ã —á–µ—Ä–µ–∑ "–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏—ë–º –ø–∏—â–∏" ‚Üí "–ò–∑–º–µ–Ω–∏—Ç—å" ‚Üí "–í–µ—Å (–≥)" –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –ö–ë–ñ–£ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã –∏ –ø–æ–∫–∞–∑–∞–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. 